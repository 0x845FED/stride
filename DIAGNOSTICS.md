# Compiler Diagnostics

Stride uses compiler warnings and diagnostics that can be optionally (temporarily) individually be suppressed.
This document lists which compiler diagnostics are defined and define the standard messages for easy copying into code by contributors where appropriate.

> All Stride-specific diagnostic codes consist of `STRIDE` followed by 4 decimal digits.

Guidelines for using `[Obsolete]`:
* If the gist is '*will be removed in the future*', do not provide a message or a custom `DiagnosticId`. However if the obsoletion was introduced in a previous release of Stride, remove the declaration or indicate using one of the defined diagnostics codes in which release this should be done.
* Prefer to use existing diagnostics codes for `DiagnosticId` defined hereunder if applicable to the situation. The goal is to allow other developers to disable the warning if it isn't applicable to them or the number of warnings hinders their focus on their work.
* Prefer to use the message defined hereunder for the `DiagnosticId` you use, unless modifying or replacing the error message adds significant benefit to the developer *reading* the error message. Weigh consistency against the benefit.

## Standard Compiler Diagnostics
There is ample use of standard diagnostics codes defined by the compiler:
* `CS1029` is the code for all errors generated by the `#error` directive.
* `CS8304` is the code for all warnings generated by the `#warning` directive.
* `CS0618`: `x` is obsolete. Developers know what this means and when to use it, through `[Obsolete]` without a `DiagnosticId`.

> Prefer not to use a custom message to `[Obsolete]` if the gist is *'Will be removed in the future'*; that is what the standard message *'`x` is obsolete.' already unambiguously does.

Where `[Obsolete]` cannot be used, e.g. in method bodies, we use `#error` and `#warning`.
The message should clearly but briefly indicate why the error or warning is generated and how to fix it.

For more information see [Error and warning information](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/preprocessor-directives#error-and-warning-information).

## Stride Compiler Diagnostics

```CS
[Obsolete("Do not allocate temporary buffers. Consider using a caller-provided buffer, renting an array, or using stackalloc.", DiagnosticId = "STRIDE6100")]
private static byte[] TypeSpecificPermanentTemporaryBuffer;
```

Allocate a code in the appropriate range:

|Prefix|Code|Category/Description|
|:--|:--|:--|
|`STRIDE0`||**Stride Build Tools Diagnostics**
|`STRIDE00`||**AssemblyProcessor**
||`STRIDE0000`|A method body was patched.|
||`STRIDE0001`|The assembly metadata was modified or a type was added.|
|`STRIDE1`||**Pre-existing obsoletions**
||`STRIDE1040`|The type or member was obsoleted before Stride 4.1 was released and will be removed in the release after Stride 4.1.
||`STRIDE1041`|The type or member was obsoleted when Stride 4.1 was the last released version and will be removed in the release following the release after Stride 4.1.
|`STRIDE6`||**Embrace modern .NET.**
|`STRIDE60`||**Specific kinds of obsoletions.**
||`STRIDE6000`|Do not use. This is a *very strong* deprecation. Use will under no circumstance be accepted. Used for IL weaving and other high-risk modifications to IL or how the .NET runtime works.
||`STRIDE6001`|Replace with the standard .NET feature or a specialized Stride feature indicated in the warning.
||`STRIDE6002`|Consider renting an array. Use GC.AllocateArray or GC. AllocateUninitializedArray and verify natural alignment of the type T if allocation cannot be avoided.
||`STRIDE6003`|Avoid using unsafe code where possible. High performance alternatives exist that do not require unsafe code and simplify debugging.
|`STRIDE61`||**Memory Efficiency and Performance Issues.**
||`STRIDE6100`|Do not allocate temporary buffers. Consider using a caller-provided buffer, renting an array, or using stackalloc.
||`STRIDE6101`|Unconditionally allocates. Read into the destination memory.
||`STRIDE6102`|Pass small structs by value to reduce register allocation and improve inlining. *-or-* Return structs by value. If they do not fit in a register, the compiler already has the caller provide a pointer to the result to the callee.